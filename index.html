<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>떡잎방범대 정보 센터</title>
  <style>
    :root{
      --card:#ffffff; --ink:#0f172a; --muted:#475569; --accent:#22c55e; --border:#e5e7eb;
      --company:#3b82f6; --civil:#16a34a; --org:#8b5cf6; --magazine:#f97316;
      --up:#16a34a; --down:#dc2626; --e:cubic-bezier(.22,.9,.24,1);
    }
    html { box-sizing: border-box; font-size:17px; overflow-y:scroll; }
    *, *::before, *::after { box-sizing: inherit; }
    body{margin:0;font-family:"Noto Sans KR",system-ui,-apple-system,Segoe UI,Roboto,sans-serif;color:var(--ink);background:#f0fdf4;line-height:1.6}

    /* 헤더 */
    header{background:#fff;border-bottom:1px solid var(--border);padding:20px;text-align:center;box-shadow:0 2px 6px rgba(0,0,0,.05)}
    header h1{margin:0;font-size:30px;color:var(--accent);font-weight:900;cursor:pointer;transition:transform .2s var(--e)}
    header h1:hover{transform:scale(1.02)}

    /* 레이아웃 */
    .layout{display:grid;grid-template-columns:300px 1fr 300px;column-gap:40px;row-gap:24px;max-width:1600px;margin:20px auto;padding:0 30px}
    main{display:flex;flex-direction:column;gap:20px}

    /* 좌우 사이드 */
    aside{background:var(--card);border-radius:14px;padding:20px;box-shadow:0 4px 12px rgba(0,0,0,.06);position:sticky;top:20px;height:500px;overflow-y:auto}
    aside h3{margin:0 0 12px;color:var(--accent);font-size:16px;font-weight:700}
    aside ul{margin:0;padding-left:18px}
    aside li{margin-bottom:6px}
    .aside-box{margin-bottom:20px;padding:12px;border-radius:10px;background:#fff}
    .aside-box h3{margin:0 0 10px;font-size:16px;font-weight:700;color:var(--accent)}

    /* 히어로 */
    .hero{text-align:center;padding:40px;border-radius:16px;background:linear-gradient(135deg,#bbf7d0,#ecfdf5);box-shadow:0 6px 16px rgba(0,0,0,.08);margin:20px 0;animation:fadeIn .35s var(--e)}
    .hero h2{margin:0 0 14px;color:var(--accent);font-size:26px;font-weight:800}
    .hero p{font-size:16px;color:#374151}

    /* 상단 네비 카드 */
    .nav-parts{display:flex;justify-content:center;gap:24px;margin:20px auto;flex-wrap:wrap}
    .nav-card{flex:1;min-width:150px;max-width:200px;background:linear-gradient(135deg,#dcfce7,#f0fdf4);padding:22px 16px;text-align:center;border-radius:16px;box-shadow:0 6px 14px rgba(0,0,0,.08);cursor:pointer;transition:transform .25s var(--e), box-shadow .25s var(--e)}
    .nav-card:hover{transform:translateY(-6px);box-shadow:0 10px 24px rgba(0,0,0,.12)}
    .nav-card .icon{font-size:28px;margin-bottom:10px}
    .nav-card h3{margin:0;font-size:18px;color:var(--accent);font-weight:700}

    /* 페이지 */
    section.page{display:none;padding:28px;background:var(--card);border-radius:14px;box-shadow:0 4px 12px rgba(0,0,0,.05)}
    section.page.active{display:block;animation:pageIn .28s var(--e)}
    section h2{margin:0 0 16px;color:var(--accent);font-size:21px;font-weight:700}

    /* 카테고리 탭 버튼 */
    .sub-nav{display:flex;gap:12px;margin:20px 0;flex-wrap:wrap}
    .sub-nav button{padding:10px 18px;border:none;border-radius:8px;background:#d1fae5;color:#065f46;font-size:15px;font-weight:700;cursor:pointer;transition:transform .18s var(--e), filter .18s var(--e)}
    .sub-nav button:hover{filter:brightness(.96); transform:translateY(-2px)}
    .sub-nav button.active{background:#16a34a;color:#fff;}

    .sub-page{display:none;margin-top:16px}
    .sub-page.active{display:block;animation:fadeIn .25s var(--e)}

    /* 표 */
    table{width:100%;border-collapse:separate;border-spacing:0;margin:10px 0 24px 0;background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 2px 8px rgba(0,0,0,.05)}
    th,td{padding:12px 14px;border-bottom:1px solid #eef2f7;font-size:15px}
    th{background:#f8fafc;color:#0f172a;text-align:left}
    tr:last-child td{border-bottom:none}

    /* 차량 판매 카드 */
    .car-sale-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:20px;margin-top:20px}
    .car-card{background:#fff;border-radius:16px;padding:20px;box-shadow:0 6px 16px rgba(0,0,0,.08);text-align:center;cursor:pointer;transition:transform .25s var(--e), box-shadow .25s var(--e);border:2px solid transparent;animation:fadeInUp .4s ease forwards;}
    .car-card:hover{transform:translateY(-6px);box-shadow:0 10px 24px rgba(0,0,0,.12);border-color:var(--accent);}
    .car-card .icon{font-size:36px;margin-bottom:8px}
    .car-card h4{margin:0 0 6px;font-size:18px;font-weight:800;color:var(--accent)}
    .car-card .price{display:inline-block;background:#dcfce7;color:#065f46;font-weight:700;font-size:16px;padding:6px 14px;border-radius:50px}

    /* 모달 */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(15,23,42,.45);backdrop-filter:saturate(1.2) blur(2px);z-index:50}
    .modal.show{display:flex;animation:fadeIn .2s var(--e)}
    .modal-content{position:relative;width:min(680px,92vw);max-height:85vh;overflow:auto;background:#fff;border-radius:16px;padding:22px 20px;box-shadow:0 20px 60px rgba(0,0,0,.25);animation:zoomFade .24s var(--e)}
    .modal-close{position:absolute;right:12px;top:10px;border:none;background:#f1f5f9;border-radius:8px;padding:6px 10px;cursor:pointer}
    .modal h2{margin:0 0 6px;font-size:22px;color:#111827}
    .tagline{margin:0 0 12px;color:#16a34a;font-weight:700}

    .modal-nav{display:flex;gap:8px;margin:10px 0 14px}
    .modal-nav button{border:none;background:#e2e8f0;color:#0f172a;padding:8px 12px;border-radius:8px;font-weight:700;cursor:pointer}
    .modal-nav button:hover{filter:brightness(.96)}
    .modal-tab{display:none}
    .modal-tab.active{display:block}
    #modalOrgList,#modalProdList{list-style:none;margin:0;padding:0}
    #modalOrgList li{padding:6px 2px}
    .org-title{font-weight:900;color:#0f172a}
    .org-section{margin:6px 0 4px 0;color:#2563eb;font-weight:800}
    .org-item .dot{display:inline-block;width:6px;height:6px;border-radius:50%;background:#a7f3d0;margin-right:8px;transform:translateY(-1px)}
    .org-total{margin-top:6px;font-weight:800;color:#059669}

    .prod-card{border:1px solid #e5e7eb;border-radius:12px;padding:12px 14px;margin:8px 0;box-shadow:0 1px 4px rgba(0,0,0,.04);animation:fadeInUp .32s var(--e)}
    .prod-title{font-weight:900}
    .prod-price{color:#047857;font-weight:900}
    .prod-note{color:#6b7280;font-size:13px;margin-top:4px}

    /* 애니메이션 */
    @keyframes fadeIn{from{opacity:0;transform:translateY(4px)} to{opacity:1;transform:none}}
    @keyframes pageIn{from{opacity:0;transform:translateY(8px)} to{opacity:1;transform:none}}
    @keyframes fadeInUp{from{opacity:0;transform:translateY(12px)} to{opacity:1;transform:none}}
    @keyframes zoomFade{from{opacity:0;transform:scale(.95)} to{opacity:1;transform:scale(1)}}
  </style>
</head>
<body>
  <header><h1 onclick="showPage('home')">떡잎방범대 정보 센터</h1></header>

  <div class="layout">
    <!-- 왼쪽 -->
    <aside>
      <div class="aside-box">
        <h3>📢 공지사항</h3>
        <ul>
          <li>떡잎방범대 정보 센터 OPEN</li>
          <li>떡잎방범대 투자 센터 리뉴얼</li>
          <li>🙏문의: 703 김남정, 디코 DM</li>
        </ul>
      </div>
      <div class="aside-box">
        <h3>🎉 다가오는 이벤트</h3>
        <ul>
          <li>🎴 작두 호스트바</li>
          <li>🍀 떡잎방범대 이벤트</li>
          <li>💍 정부장, 원두 결혼식</li>
        </ul>
      </div>
    </aside>

    <!-- 중앙 -->
    <main>
      <div class="nav-parts">
        <div class="nav-card" onclick="showPage('home')"><div class="icon">🏠</div><h3>홈</h3></div>
        <div class="nav-card" onclick="showPage('market')"><div class="icon">🥕</div><h3>당근마켓</h3></div>
        <div class="nav-card" onclick="showPage('category')"><div class="icon">📂</div><h3>카테고리</h3></div>
        <div class="nav-card" onclick="showPage('stats')"><div class="icon">📈</div><h3>거래 통계</h3></div>
      </div>

      <div class="hero"><h2>📊 정보 센터</h2><p>리얼월드의 아이템 시세와 조직 정보를 한눈에!</p></div>

      <!-- 홈 (비워둠: 필요시 추가) -->
      <section id="home" class="page active">
        <h2>🏠 홈</h2>
        <p>상단 네비를 눌러 이동하세요.</p>
      </section>

      <!-- 당근마켓 (간단 도움말만) -->
      <section id="market" class="page">
        <h2>🥕 당근마켓</h2>
        <button onclick="openHelp('market')">도움말 보기</button>
      </section>

      <!-- 카테고리 (단 하나) -->
      <section id="category" class="page">
        <h2>📂 카테고리 & 차량 시세</h2>

        <!-- 탭 버튼 -->
        <div class="sub-nav">
          <button onclick="showCatTab('categories')" id="catBtn-categories" class="active">카테고리별 시세표</button>
          <button onclick="showCatTab('cars')" id="catBtn-cars">차량 판매 시세표</button>
        </div>

        <!-- 카테고리별 시세표 탭 -->
        <div id="catTab-categories" class="sub-page active">
          <div class="sub-nav" style="gap:8px">
            <button onclick="scrollToSection('chair')">🪑 의자</button>
            <button onclick="scrollToSection('support-car')">🚗 후원 차량</button>
            <button onclick="scrollToSection('island-car')">🏝 극락도 차량</button>
            <button onclick="scrollToSection('effect')">✨ 이펙트</button>
            <button onclick="scrollToSection('skin')">🎭 스킨</button>
            <button onclick="scrollToSection('dance')">💃 행동·댄스·동상</button>
            <button onclick="scrollToSection('item')">🧰 기타</button>
          </div>

          <h3 id="chair">🪑 의자 종류</h3>
          <table>
            <tr><th>아이템</th><th>시세</th></tr>
            <tr><td>달의자</td><td>230억~250억</td></tr>
            <tr><td>커피의자</td><td>230억~250억</td></tr>
            <tr><td>새장의자</td><td>160억~190억</td></tr>
            <tr><td>구름의자</td><td>270억~300억</td></tr>
          </table>

          <h3 id="support-car">🚗 후원 차량</h3>
          <table>
            <tr><th>아이템</th><th>시세</th></tr>
            <tr><td>M1</td><td>170억~200억</td></tr>
            <tr><td>미니바티</td><td>150억~180억</td></tr>
            <tr><td>이그너스</td><td>245억~270억</td></tr>
            <tr><td>M2</td><td>170억~200억</td></tr>
            <tr><td>시노비</td><td>100억~120억</td></tr>
            <tr><td>네로</td><td>230억~250억</td></tr>
            <tr><td>쇼타로</td><td>80억~100억</td></tr>
            <tr><td>M3</td><td>150억~200억</td></tr>
            <tr><td>테저랙트</td><td>270억~300억</td></tr>
            <tr><td>M4</td><td>170억~200억</td></tr>
            <tr><td>하쿠쵸우</td><td>80억~110억</td></tr>
          </table>

          <h3 id="island-car">🏝 극락도 차량</h3>
          <table>
            <tr><th>아이템</th><th>시세</th></tr>
            <tr><td>바나나카</td><td>60억~80억</td></tr>
            <tr><td>고양카</td><td>70억~100억</td></tr>
            <tr><td>피넛카</td><td>70억~100억</td></tr>
          </table>

          <h3 id="effect">✨ 이펙트</h3>
          <table>
            <tr><th>아이템</th><th>시세</th></tr>
            <tr><td>불손</td><td>220억~270억</td></tr>
            <tr><td>불발</td><td>200억~250억</td></tr>
            <tr><td>리프</td><td>140억~180억</td></tr>
            <tr><td>번개</td><td>130억~150억</td></tr>
            <tr><td>꽃잎비</td><td>250억~280억</td></tr>
          </table>

          <h3 id="skin">🎭 스킨</h3>
          <table>
            <tr><th>아이템</th><th>시세</th></tr>
            <tr><td>다니엘</td><td>200억~240억</td></tr>
            <tr><td>HJ</td><td>150억~200억</td></tr>
            <tr><td>YH</td><td>140억~180억</td></tr>
            <tr><td>다혜</td><td>80억~130억</td></tr>
            <tr><td>유자</td><td>80억~130억</td></tr>
            <tr><td>문신남</td><td>????</td></tr>
            <tr><td>병아리</td><td>150억~180억</td></tr>
            <tr><td>고양이</td><td>150억~180억</td></tr>
          </table>

          <h3 id="dance">💃 행동·댄스·동상</h3>
          <table>
            <tr><th>아이템</th><th>시세</th></tr>
            <tr><td>브레이크댄스</td><td>10억~15억</td></tr>
            <tr><td>오징어댄스</td><td>10억~15억</td></tr>
            <tr><td>브로큰레그</td><td>5억~8억</td></tr>
            <tr><td>마그네틱</td><td>30억~45억</td></tr>
            <tr><td>텔미댄스</td><td>30억~40억</td></tr>
            <tr><td>버스안에서댄스</td><td>6억~8억</td></tr>
            <tr><td>스마트댄스</td><td>30억~38억</td></tr>
            <tr><td>소다팝댄스</td><td>38억~46억</td></tr>
            <tr><td>팝핀댄스</td><td>5억~10억</td></tr>
            <tr><td>스캇앤젤다댄스</td><td>20억~28억</td></tr>
            <tr><td>뻣뻣로봇댄스</td><td>6억~10억</td></tr>
            <tr><td>골반흔들기</td><td>15억~20억</td></tr>
            <tr><td>크레이지트워킹</td><td>15억~20억</td></tr>
            <tr><td>슬릭백</td><td>18억~27억</td></tr>
            <tr><td>이리와</td><td>5억~8억</td></tr>
            <tr><td>언더더씨</td><td>5억~8억</td></tr>
            <tr><td>쌍뻐큐</td><td>10억~15억</td></tr>
            <tr><td>맘맘</td><td>7억~11억</td></tr>
            <tr><td>회전회오리</td><td>18억~24억</td></tr>
            <tr><td>쏘리댄스</td><td>5억~10억</td></tr>
            <tr><td>하트 동상포즈(남)</td><td>10억~15억</td></tr>
            <tr><td>하트 동상포즈(여)</td><td>11억~16억</td></tr>
            <tr><td>동상포즈(남)</td><td>10억~15억</td></tr>
            <tr><td>동상포즈(여)</td><td>11억~15억</td></tr>
            <tr><td>무릎앉기</td><td>7억~10억</td></tr>
            <tr><td>조신하게 앉기</td><td>8억~10억</td></tr>
            <tr><td>괴속질주</td><td>10억~13억</td></tr>
            <tr><td>흔들어</td><td>15억~18억</td></tr>
            <tr><td>오예스</td><td>9억~15억</td></tr>
            <tr><td>요가포즈</td><td>13억~16억</td></tr>
            <tr><td>냄새나</td><td>10억~15억</td></tr>
            <tr><td>쓰러지기</td><td>5억~7억</td></tr>
            <tr><td>기도하는</td><td>5억~10억</td></tr>
            <tr><td>내빵뎅이</td><td>5억~8억</td></tr>
          </table>

          <h3 id="item">🧰 기타 아이템</h3>
          <table>
            <tr><th>아이템</th><th>시세</th></tr>
            <tr><td>롤러</td><td>60억~80억</td></tr>
            <tr><td>펫 입양권</td><td>160억~200억</td></tr>
          </table>
        </div>

        <!-- 차량 판매 시세표 탭 -->
        <div id="catTab-cars" class="sub-page">
          <h3>🚗 차량 판매 시세표</h3>
          <div class="car-sale-grid" id="carGrid">
            <!-- JS에서 생성 -->
          </div>
        </div>
      </section>

      <!-- 거래 통계 -->
      <section id="stats" class="page">
        <h2>📈 거래 통계</h2>
        <table id="itemTable">
          <thead><tr><th>아이템</th><th>거래량</th><th>평균가</th><th>변동</th></tr></thead>
          <tbody></tbody>
        </table>
      </section>
    </main>

    <!-- 오른쪽 -->
    <aside>
      <h3>🔥 인기 TOP 5</h3>
      <ul id="topList"></ul>
      <h3>⏰ 실시간 알림</h3>
      <ul><li>-</li></ul>
    </aside>
  </div>

  <!-- ===== 모달 영역 ===== -->
  <!-- 엔티티 모달 -->
  <div id="modal" class="modal" aria-hidden="true">
    <div id="modalContent" class="modal-content">
      <button class="modal-close" onclick="closeModal()">✖</button>
      <h2 id="modalTitle"></h2>
      <p id="modalTagline" class="tagline"></p>

      <div class="modal-nav">
        <button onclick="showModalTab('org')" data-tab="org">조직도</button>
        <button onclick="showModalTab('products')" data-tab="products">제품</button>
        <button onclick="showModalTab('info')" data-tab="info">정보</button>
      </div>

      <div id="modal-org" class="modal-tab active">
        <ul id="modalOrgList"></ul>
      </div>

      <div id="modal-products" class="modal-tab">
        <ul id="modalProdList"></ul>
      </div>

      <div id="modal-info" class="modal-tab">
        <div id="modalInfoText"></div>
      </div>
    </div>
  </div>

  <!-- 차량 모달 -->
  <div id="carModal" class="modal" aria-hidden="true">
    <div class="modal-content">
      <button class="modal-close" onclick="closeCarModal()">✖</button>
      <h2 id="carModalTitle">차량</h2>
      <p id="carModalPrice"></p>
      <p id="carModalDesc"></p>
    </div>
  </div>

  <!-- 사연 모달 -->
  <div id="storyModal" class="modal" aria-hidden="true">
    <div class="modal-content">
      <button class="modal-close" onclick="closeStory()">✖</button>
      <h2 id="sModalTitle"></h2>
      <p id="sModalMeta"></p>
      <p id="sModalCat"></p>
      <p id="sModalSong"></p>
      <p id="sModalBody"></p>
    </div>
  </div>

  <!-- 도움말 모달 -->
  <div id="helpModal" class="modal" aria-hidden="true">
    <div class="modal-content">
      <button class="modal-close" onclick="closeHelp()">✖</button>
      <h2 id="helpTitle"></h2>
      <p id="helpTagline"></p>
      <div id="helpContent"></div>
    </div>
  </div>

  <!-- ===== 기본 JS ===== -->
  <script>
    /* ---------- 네비/페이지 ---------- */
    function showPage(pageId){
      document.querySelectorAll('.page').forEach(s=>s.classList.remove('active'));
      const el=document.getElementById(pageId);
      if(el){ el.classList.add('active'); window.scrollTo({top:0,behavior:'smooth'}); }
    }
    function goHome(){ showPage('home'); }

    /* ---------- 카테고리 탭 전환 (중복 없음) ---------- */
    function showCatTab(which){
      const tabIds = ['categories','cars'];
      tabIds.forEach(id=>{
        document.getElementById('catTab-'+id)?.classList.toggle('active', id===which);
        document.getElementById('catBtn-'+id)?.classList.toggle('active', id===which);
      });
      const sec = document.getElementById('category');
      if(sec) sec.scrollIntoView({behavior:'smooth', block:'start'});
    }

    /* ---------- 퀵 스크롤 ---------- */
    function scrollToSection(id){
      const el=document.getElementById(id);
      if(el) el.scrollIntoView({behavior:"smooth",block:"start"});
    }

    /* ---------- 거래 통계/인기 TOP5 ---------- */
    const items=[
      {name:"펫 입양권",volume:12,price:200,change:+3.5},
      {name:"트월킹",volume:9,price:33,change:-1.2},
      {name:"쇼타로",volume:7,price:95,change:+0.8},
      {name:"네로",volume:5,price:245,change:+1.1},
      {name:"테저랙트",volume:4,price:295,change:-0.6},
    ];
    function renderTable(){
      const tbody=document.querySelector("#itemTable tbody");
      if(!tbody) return;
      tbody.innerHTML="";
      items.forEach(it=>{
        const cls=it.change>0?"up":it.change<0?"down":"";
        tbody.insertAdjacentHTML('beforeend',`
          <tr>
            <td>${it.name}</td>
            <td>${it.volume}</td>
            <td>${it.price}억</td>
            <td class="${cls}">${it.change>0?"▲":it.change<0?"▼":"-"} ${Math.abs(it.change)}%</td>
          </tr>`);
      });
    }
    function renderTop(){
      const ul=document.querySelector("#topList");
      if(!ul) return;
      ul.innerHTML=items.slice().sort((a,b)=>b.volume-a.volume).slice(0,5)
        .map(it=>`<li>${it.name} (${it.volume}건)</li>`).join("");
    }

    /* ---------- 차량 카드/모달 ---------- */
    const CAR_DATA = {
      '테저랙트': { price:'300억', desc:'최고속도 400km/h, 전자식 서스펜션, 탄소섬유 모노코크 섀시.' },
      '네로': { price:'250억', desc:'밸런스가 좋은 전천후 슈퍼카. 일상·레이스 모두 OK.' },
      'M1': { price:'200억', desc:'스포티한 클래식 모델. 커스텀 파츠 호환성 우수.' },
      '쇼타로': { price:'100억', desc:'바이크계의 아이콘. 가속·핸들링 특화.' }
    };
    const carList = [
      {key:'테저랙트',icon:'🚀'},
      {key:'네로',icon:'🏎️'},
      {key:'M1',icon:'🚗'},
      {key:'쇼타로',icon:'🏍️'},
    ];
    function renderCars(){
      const grid = document.getElementById('carGrid');
      if(!grid) return;
      grid.innerHTML = carList.map(c=>{
        const d=CAR_DATA[c.key];
        return `
        <div class="car-card" data-car="${c.key}">
          <div class="icon">${c.icon}</div>
          <h4>${c.key}</h4>
          <p class="price">${d?.price||'-'}</p>
        </div>`;
      }).join('');
    }
    function toggleCarModal(open){
      const modal = document.getElementById('carModal'); if(!modal) return;
      if(open){ modal.classList.add('show'); modal.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden'; }
      else{ modal.classList.remove('show'); modal.setAttribute('aria-hidden','true'); document.body.style.overflow=''; }
    }
    function openCarModal(){ toggleCarModal(true); }
    function closeCarModal(){ toggleCarModal(false); }

    document.addEventListener('click', (e)=>{
      const card = e.target.closest('.car-card');
      if(!card) return;
      const name = card.dataset.car;
      const data = CAR_DATA[name] || {};
      document.getElementById('carModalTitle').textContent = name || '차량';
      document.getElementById('carModalPrice').textContent = '가격: ' + (data.price || '-');
      document.getElementById('carModalDesc').textContent = data.desc || '세부 정보가 없습니다.';
      openCarModal();
    });

    /* ---------- 엔티티 모달(필요 시 openEntity 호출) ---------- */
    function formatOrg(lines){
      return (lines||[]).map(raw=>{
        const t=(raw??"").trim();
        if(!t) return `<li class="org-gap"></li>`;
        if(/^<strong/i.test(t)) return `<li class="org-title">${t}</li>`;
        if(/^\W*🌐|\W*📝|\W*🎤|\W*📻|\W*🛠️|\W*🎬/.test(t)) return `<li class="org-section"><span>${t.replace(/^(\W+)/,'')}</span></li>`;
        if(/^\[.*\]$/.test(t)) {
          const label=t.replace(/^\[|\]$/g,"");
          return `<li class="org-section"><span>${label}</span></li>`;
        }
        if(t.includes("총 인원") || t.includes("총원")) return `<li class="org-total">${t}</li>`;
        return `<li class="org-item"><span class="dot"></span>${t}</li>`;
      }).join("");
    }
    function openEntity(ent){
      const modal=document.getElementById("modal");
      const content=document.getElementById("modalContent");
      document.getElementById("modalTitle").textContent=ent.name||'—';
      document.getElementById("modalTagline").textContent = ent.tagline || "—";
      document.querySelectorAll('.modal-tab').forEach(t=>t.classList.remove('active'));
      document.getElementById("modal-org").classList.add('active');

      const orgUL=document.getElementById("modalOrgList");
      orgUL.innerHTML = (ent.org && ent.org.length) ? formatOrg(ent.org)
        : "<li class='org-item'><span class='dot'></span>등록된 조직도 정보가 없습니다.</li>";

      const prodUL = document.getElementById("modalProdList");
      const hasProducts = Array.isArray(ent.products) && ent.products.length > 0;
      if (hasProducts) {
        prodUL.innerHTML = ent.products.map((p, i) => {
          const delay = i * 40;
          const note = p.note ? `<div class="prod-note">${p.note}</div>` : "";
          return `
            <li class="prod-card" style="animation-delay:${delay}ms">
              <div class="prod-title">${p.name}</div>
              <div class="prod-price">${p.price}</div>
              ${note}
            </li>`;
        }).join("");
      } else { prodUL.innerHTML = ""; }

      const info=document.getElementById("modalInfoText");
      info.innerHTML=`<b>한 마디:</b> ${ent.tagline||"—"}<br>${ent.info||""}`;

      // 제품 탭 버튼 표시/숨김
      const btnProducts = document.querySelector('.modal-nav button[data-tab="products"]');
      if(btnProducts) btnProducts.style.display = hasProducts ? '' : 'none';

      modal.classList.add('show');
      document.body.style.overflow = 'hidden';
      modal.setAttribute('aria-hidden','false');
    }
    function closeModal(){
      document.getElementById("modal").classList.remove('show');
      document.body.style.overflow = '';
      document.getElementById("modal").setAttribute('aria-hidden','true');
    }
    function showModalTab(id){
      document.querySelectorAll('.modal-tab').forEach(t=>t.classList.remove('active'));
      document.getElementById("modal-"+id).classList.add('active');
    }

    /* ---------- 도움말 ---------- */
    const HELP_TEXTS = {
      market: `
        <ul>
          <li><b>당근마켓</b>은 개인 간 아이템 거래를 위한 커뮤니티 장터입니다.</li>
          <li>당근마켓 이용 시 <b>기재비용 1억</b>입니다.</li>
          <li>기재를 위해 <b>703 김남정 디스코드 DM</b>을 해주세요.</li>
          <li><b>닉네임</b>, <b>고번</b>, <b>품목</b>, <b>가격</b>을 명확히 기재해 주세요.</li>
          <li>안전 거래 팁: 거래 전·후 <b>스크린샷</b> 보관, <b>조건/수수료</b> 사전 합의.</li>
          <li>운영진은 거래에 개입하지 않으며, 당근마켓은 <b>중개 역할</b>입니다.</li>
        </ul>`
    };
    function openHelp(key){
      const modal = document.getElementById('helpModal');
      document.getElementById('helpTitle').textContent = key==='market' ? '당근마켓 도움말' : '도움말';
      document.getElementById('helpTagline').textContent = key==='market' ? '커뮤니티 장터 이용 안내' : '안내';
      document.getElementById('helpContent').innerHTML = HELP_TEXTS[key] || '<p>안내가 없습니다.</p>';
      modal.classList.add('show'); modal.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden';
    }
    function closeHelp(){
      const modal = document.getElementById('helpModal');
      modal.classList.remove('show'); modal.setAttribute('aria-hidden','true'); document.body.style.overflow='';
    }

    /* ---------- 사연 모달 (옵션) ---------- */
    const storyMap = new Map();
    function openStory(id){
      const s = storyMap.get(id); if(!s) return;
      document.getElementById('sModalTitle').textContent = s.title || '(제목 없음)';
      const nameStr = s.isAnon ? '익명' : (s.nick || '—');
      const codeStr = (!s.isAnon && s.code) ? ` (${s.code})` : '';
      document.getElementById('sModalMeta').textContent = `${nameStr}${codeStr} · ${s._time || ''}`;
      document.getElementById('sModalBody').textContent = s.body || '';
      document.getElementById('sModalCat').textContent = s.category || '기타';
      const song = document.getElementById('sModalSong');
      if(s.song){ song.style.display='inline-flex'; song.textContent = `🎵 ${s.song}`; } else { song.style.display='none'; }
      const m = document.getElementById('storyModal');
      m.classList.add('show'); m.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden';
    }
    function closeStory(){
      const m = document.getElementById('storyModal');
      m.classList.remove('show'); m.setAttribute('aria-hidden','true'); document.body.style.overflow='';
    }

    /* ---------- 초기 렌더 ---------- */
    document.addEventListener('DOMContentLoaded', ()=>{
      renderCars();
      renderTable();
      renderTop();
      showPage('home'); // 첫 페이지
      showCatTab('categories'); // 기본 탭
    });
  </script>

  <!-- ===== Firebase (옵션) — 실제 프로젝트 키로 교체 시 사용 ===== -->
  <script type="module">
    // 이 블록은 붙여도 에러 안 나도록 보호
    (async ()=>{
      try{
        const { initializeApp } = await import("https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js");
        const { getFirestore, collection, addDoc, getDocs, serverTimestamp } =
          await import("https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js");

        // 예시 설정(동작 테스트용). 실제 값으로 교체하세요.
        const firebaseConfig = {
          apiKey: "AIzaSyEXAMPLE",
          authDomain: "example.firebaseapp.com",
          projectId: "example",
          storageBucket: "example.appspot.com",
          messagingSenderId: "000000000",
          appId: "1:000000000:web:example"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // 폼이 있을 때만 동작(현재 예시는 폼 미포함)
        const storyForm = document.getElementById('storyForm');
        if(storyForm){
          storyForm.addEventListener('submit', async (e)=>{
            e.preventDefault();
            const data = {
              nick: storyForm.nick.value || '익명',
              code: storyForm.code.value || '',
              category: storyForm.category.value || '기타',
              title: storyForm.title.value || '(제목 없음)',
              body: storyForm.body.value || '',
              song: storyForm.song.value || '',
              isAnon: storyForm.isAnon?.checked,
              _time: new Date().toLocaleString(),
              timestamp: serverTimestamp()
            };
            try {
              await addDoc(collection(db,"stories"), data);
              alert('사연이 제출되었습니다!');
              storyForm.reset();
            }catch(err){
              alert('에러: '+err.message);
            }
          });
        }

        // 목록 로드 (해당 리스트가 있을 때만)
        async function loadStories(){
          const list = document.getElementById('storyList'); if(!list) return;
          const snap = await getDocs(collection(db,"stories"));
          list.innerHTML="";
          snap.forEach(doc=>{
            const d=doc.data();
            const li=document.createElement('li');
            li.textContent = `${d.title} - ${d.nick}`;
            li.onclick=()=>openStory(doc.id);
            storyMap.set(doc.id,d);
            list.appendChild(li);
          });
        }
        await loadStories();
      }catch(err){
        // Firebase가 필요 없거나 키가 가짜일 때 조용히 무시
        console.warn('Firebase 비활성(옵션):', err?.message || err);
      }
    })();
  </script>
</body>
</html>
